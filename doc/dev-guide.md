# The Stripes Module Developer's Guide

<!-- ../../okapi/doc/md2toc -l 2 dev-guide.md -->
* [Status and Scope](#status-and-scope)
* [Code quality](#code-quality)
* [Specifying dependencies](#specifying-dependencies)
* [Logging](#logging)
    * [Configuring the logger](#configuring-the-logger)
    * [Using the logger](#using-the-logger)
* [Styling HTML](#styling-html)


## Status and Scope

**This document is in progress and incomplete.** In time, it will  an introduction and overview, and form a coherent narrative. For the moment, it's just a holding place for information that needs to be in the documentation somewhere, but does not yet have an obvious home.

This document is aimed at those writing application modules for Stripes -- such as the Users module, the Items module and the Scan module. Those working on the packages that make up Stripes itself (such as `stripes-connect` and `stripes-components`) must follow rather different conventions.


## Code quality

In general, we expect every module to pass [ESLint](http://eslint.org/) with no errors.

We aim to write tests (generally using [Mocha](https://mochajs.org/), though at present we are not as far along with this as we might wish. Over time, we will develop coventions for how best to mock parts of FOLIO for testing purposes.

If you are not sure about some code you have written, ask for a code review from another member of the team. We do _not_, as a matter of course, review all code: our judgement at present is that doing so would cost us more than it bought us.


## Specifying dependencies

ESLint cleanliness means, among other things, that every package that a module uses must be listed as a dependency in its `package.json`. Modules may not blindly rely on the provision of facilities such as React and Redux via Stripes Core, but must specify for themselves what they use, and what version they require.

Specifically:

* Every package that a module imports (`react`, `react-router`, `stripes-components`, etc.) should be declared as a dependency in `package.json` -- most easily added using `yarn add` _packageName_.

* When `stripes-connect` is used -- even when it's not imported, but the curried `connect` function from the props of the top-level component is used -- it should be declared as a peer-dependency. (This is essentially specifying what version of the stripes-connect API we are relying on).


## Logging

Logging in Stripes is done using [stripes-logger](https://github.com/folio-org/stripes-logger), a simple generalisation of `console.log` where each message is assigned to a category, and the developer can decide at run-time which categories should be emitted and which ignored. In this way, it's possible to see (for example) only logging of how stripes-connect paths are resolved.

### Configuring the logger

The `config` section od the Stripes configuration file -- usually caled `stripes.config.js` or similar -- can be used to configure logging. The three relevant settings are:

* `logCategories`: a comma-separated list of categories to include: for example, `'core,action,path'`. If this is not specified, the default is to log the single category `redux`. (See below for existing categories.)
* `logPrefix`: a string which, if defined, is included at the start of all log messages. This can be expicitly set to `undefined`, but defaults to `'stripes'`.
* `logTimestamp`: a boolean which, if true, results in an ISO-format timestamp being emitted at the start of each logged message (after the logPrefix, if any). Defaults to false.

The stripes-core library lets you make up categories on the fly -- so, for example, a Circulation module might use the category `'circ'`. But some categories are in use by Stripes itself, and can usefully be included in the logCategories setting. These include:

* `core` -- messages emitted by stripes-core itself.
* `redux` -- messages generated by the `redux-logger` library, describing Redux actions.
* `path` -- messages generated by stripes-conect describing how paths are generated by string substitution and fallback.
* `mpath` -- conventionally used by application modules to log path generations by path functions.
* `action` -- conventionally used by application modules to log user actions such as searching, sorting and editing.

### Using the logger

The configured logger object is furnished as the `logger` property to the top-level component of each UI module. It is the responsibility of that component to ensure it is passed down to any subcomponents that need to use it. Logging can therefore be invoked using `this.props.logger.log('cat', args)`.

In addition, the logger is passed as the fourth argument into stripes-connect path functions.


## Styling HTML

In general, modules should not use CSS directly, nor rely on styling libraries such as Bootstrap, but should use low-lever components from `stripes-components`, which are pre-styled according to Stripes conventions.


